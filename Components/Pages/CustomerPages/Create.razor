@page "/customers/create"
@using Microsoft.EntityFrameworkCore
@using SpaFinalProject.Components.Models
@inject IDbContextFactory<SpaFinalProject.Data.SpaFinalProjectContext> DbFactory
@inject NavigationManager NavigationManager

<PageTitle>Register</PageTitle>

<div class="register-wrapper">
    <div class="register-container">
        <h2>Register</h2>
        <hr />

        <EditForm method="post" Model="Customer" OnValidSubmit="AddCustomer" FormName="create" Enhance>
            <DataAnnotationsValidator />

            @* We can keep the validation summary, but styling it to fit the card *@
            <ValidationSummary class="alert-message" role="alert" />

            <div class="form-group">
                <label for="fname">First Name</label>
                <InputText id="fname" @bind-Value="Customer.Fname" class="form-control" />
                <ValidationMessage For="() => Customer.Fname" class="text-danger" />
            </div>

            <div class="form-group">
                <label for="lname">Last Name</label>
                <InputText id="lname" @bind-Value="Customer.Lname" class="form-control" />
                <ValidationMessage For="() => Customer.Lname" class="text-danger" />
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <InputText id="email" @bind-Value="Customer.email" class="form-control" />
                <ValidationMessage For="() => Customer.email" class="text-danger" />
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <InputText type="password" id="password" @bind-Value="Customer.password" class="form-control" />
                <ValidationMessage For="() => Customer.password" class="text-danger" />
            </div>

            <div class="form-group">
                <label for="phone">Phone</label>
                <InputText id="phone" @bind-Value="Customer.phone" class="form-control" />
                <ValidationMessage For="() => Customer.phone" class="text-danger" />
            </div>

            <div class="form-group">
                <label for="notes">Notes</label>
                <InputText id="notes" @bind-Value="Customer.Notes" class="form-control" />
                <ValidationMessage For="() => Customer.Notes" class="text-danger" />
            </div>

            <button type="submit">Create Account</button>

        </EditForm>
    </div>
</div>

<style>
    /* Updated Wrapper: Added overflow-y: auto.
           Because the register form is tall, we need to allow scrolling
           if the screen height is too small.
        */
    .register-wrapper {
        position: fixed;
        top: 60px; /* Height of navbar */
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start; /* Changed from center to flex-start to allow scrolling from top */
        background-color: #f0f2f5;
        z-index: 100;
        overflow-y: auto; /* Allows scrolling */
        padding-top: 40px;
        padding-bottom: 40px;
    }

    .register-container {
        background-color: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        width: 100%;
        max-width: 500px; /* Slightly wider than login because we have more data */
        border: 1px solid #ddd;
        margin-bottom: 40px; /* Space at bottom for scrolling */
    }

        .register-container h2 {
            text-align: center;
            margin-bottom: 10px;
            color: #333;
        }

    .form-group {
        margin-bottom: 15px;
    }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 500;
        }

    .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }

    button {
        width: 100%;
        padding: 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 20px;
    }

        button:hover {
            background-color: #0056b3;
        }

    .alert-message {
        color: #721c24;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        font-size: 0.9rem;
        list-style: none; /* Removes bullet points from validation summary */
    }

    .text-danger {
        font-size: 0.875rem;
        color: #dc3545;
        margin-top: 4px;
        display: block;
    }
</style>

@code {
    [SupplyParameterFromForm]
    private Customer Customer { get; set; } = new()
    {
        email = string.Empty,
        password = string.Empty
    };

    protected override void OnInitialized() => Customer ??= new()
    {
    };

    private async Task AddCustomer()
    {
        using var context = DbFactory.CreateDbContext();
        context.Customer.Add(Customer);
        await context.SaveChangesAsync();
        NavigationManager.NavigateTo("/customers");
    }
}
